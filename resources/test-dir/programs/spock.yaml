name: Spock functional test program
main:
    - module: ~{TEST_DIR}/modules/node-init.yaml
      in:
        NODE_NAME: ~@SPOCK_NODE_NAME
        IP_INVOCATION:
            ~(if:
                - ~@PRIVATE_IP
                - hostname -I
                - dig +short myip.opendns.com @resolver1.opendns.com
      out:
        SPOCK_IP: ~@IP_ADDRESS
      then:
        groups:
            - group:
                - module: ~{TEST_DIR}/modules/spock-init.yaml
#                  then:
#                    groups:
#                        - group:
#                            - ~(for:
#                                - - test
#                                  - - ~{OPSC_HOME}/spock/test/functional/api-tests/repository-credentials-test.yaml
#                                - module: ~{TEST_DIR}/modules/gingham.yaml
#                                  isolate: true
#                                  in:
#                                    TEST: ~@test
#                                    BASE: http://~{SPOCK_IP}:8889/api/v1
#                            - ~(for:
#                                - - idx
#                                  - ~(range:
#                                      - 0
#                                      - ~@TARGET_NODE_COUNT
#                                - module: ~{TEST_DIR}/modules/node-init.yaml
#                                  in:
#                                    NODE_NAME: t~{idx}
#                                  out:
#                                    TARGET_NODES:
#                                        ~(conj:
#                                            - ~@TARGET_NODES
#                                            - ~@NODE_NAME
#                        - group:
#                            - module: ~{TEST_DIR}/modules/spock-provision.yaml
#                              in:
#                                TARGET_SSH_PORT: 22
#            
